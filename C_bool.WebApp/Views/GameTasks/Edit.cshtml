@using C_bool.BLL.Enums
@model C_bool.WebApp.Models.GameTask.GameTaskEditModel

@{
    ViewData["Title"] = "Edytuj zadanie";
    var taskType = Model.Type;

    if (Model?.LeftDoneAttempts == 0)
    {
        Model.LeftDoneAttempts = null;
    }

}

<form enctype="multipart/form-data" asp-action="Edit" asp-route-taskType="@ViewData["TaskType"]" asp-route-placeId="@ViewData["PlaceId"]" class="needs-validation" novalidate>

    <!--Hidden field for TaskType - for model validation purposes-->
    <input type="hidden" asp-for="Type" value="@ViewData["TaskType"]" />

    <div class="row">
        <div class="col-12">
            <!-- Tab -->
            <div class="row">
                <div class="col-sm">
                    <h1>Edytuj zadanie</h1>
                    <h3>Kroi się coś ciekawego?</h3>
                </div>
                <div class="col-sm">
                    <div class="nav-wrapper position-relative float-end">
                        <ul class="nav nav-pills nav-pills nav-pill-circle mb-3" id="tab-34" role="tablist">
                            <li class="nav-item me-3 me-md-0">
                                <a class="nav-link text-sm-center active" aria-label="second navigation tab" id="tab-create-data" data-bs-toggle="tab" href="#create-data" role="tab" aria-controls="create-data" aria-selected="false">
                                    <span class="nav-link-icon d-block">
                                        <svg class="icon" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                            <path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z"></path>
                                            <path fill-rule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clip-rule="evenodd"></path>
                                        </svg>
                                    </span>
                                </a>
                            </li>
                            <li class="nav-item me-3 me-md-0">
                                <a class="nav-link text-sm-center" aria-label="third navigation tab" id="tab-create-description" data-bs-toggle="tab" href="#create-description" role="tab" aria-controls="create-description" aria-selected="false">
                                    <span class="nav-link-icon d-block">
                                        <svg class="icon" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                            <path fill-rule="evenodd" d="M4 4a2 2 0 012-2h4.586A2 2 0 0112 2.586L15.414 6A2 2 0 0116 7.414V16a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm2 6a1 1 0 011-1h6a1 1 0 110 2H7a1 1 0 01-1-1zm1 3a1 1 0 100 2h6a1 1 0 100-2H7z" clip-rule="evenodd"></path>
                                        </svg>
                                    </span>
                                </a>
                            </li>
                            <li class="nav-item me-3 me-md-0">
                                <a class="nav-link text-sm-center" aria-label="third navigation tab" id="tab-create-afterdonemessage" data-bs-toggle="tab" href="#create-afterdonemessage" role="tab" aria-controls="create-afterdonemessage" aria-selected="false">
                                    <span class="nav-link-icon d-block">
                                        <svg class="icon" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
                                    </span>
                                </a>
                            </li>
                            <li class="nav-item me-3 me-md-0 align-items-center">
                                <div class="form-group">
                                    <input type="submit" value="Zapisz zmiany" class="btn btn-danger btn-lg d-block" style="margin-top: 15px;" />
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <!-- End of Tab Nav -->

            <partial name="~/Views/Shared/ValidationAlert.cshtml" />

            <!-- Tab Content -->
            <div>
                <div class="card-body p-0">
                    <div class="tab-content" id="tabcontentexample-5">
                        <div class="tab-pane fade show active" id="create-data" role="tabpanel" aria-labelledby="tab-link-example-14">

                            <div class="row">
                                <div class="col-12 col-xl-8">
                                    <div class="card card-body border-0 shadow mb-4">
                                        <h2 class="h5 mb-4">Ogólne informacje o zadaniu</h2>
                                        <div class="form-group">
                                            <label asp-for="Name" class="control-label"></label>
                                            <input asp-for="Name" class="form-control" />
                                            <span asp-validation-for="Name" class="text-danger cb-alert"></span>
                                        </div>
                                        <div class="form-group">
                                            <label asp-for="ShortDescription" class="control-label"></label>
                                            <textarea asp-for="ShortDescription" class="form-control" style="height: 172px"></textarea>
                                            <span asp-validation-for="ShortDescription" class="text-danger cb-alert"></span>
                                        </div>
                                    </div>
                                    <!---Task type specific settings-->
                                    @if (taskType == TaskType.TextEntry)
                                    {
                                        <partial name="Partials/Create/_TextEntrySettings" />
                                    }

                                    <!--Task active date threshold settings-->
                                    <partial name="Partials/Create/_FromThruDate" />

                                </div>
                                <div class="col-12 col-xl-4">
                                    <div class="row">
                                        <div class="col-12 mb-4">
                                            <div class="card card-body border-0 shadow">
                                                <h2 class="h5 mb-4">Ile cebul chcesz przyznać?</h2>
                                                <div class="form-group">
                                                    <input asp-for="Points" id="pointsInput" class="form-range" type="range" min="10" step="5" max="1000" value="100" oninput="amount.value=pointsInput.value">
                                                    <div class="d-flex align-items-center me-5">
                                                        <div class="icon-shape icon-sm icon-shape-danger rounded me-3">
                                                            <svg fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                                                <path fill-rule="evenodd" d="M3 3a1 1 0 000 2v8a2 2 0 002 2h2.586l-1.293 1.293a1 1 0 101.414 1.414L10 15.414l2.293 2.293a1 1 0 001.414-1.414L12.414 15H15a2 2 0 002-2V5a1 1 0 100-2H3zm11 4a1 1 0 10-2 0v4a1 1 0 102 0V7zm-3 1a1 1 0 10-2 0v3a1 1 0 102 0V8zM8 9a1 1 0 00-2 0v2a1 1 0 102 0V9z" clip-rule="evenodd"></path>
                                                            </svg>
                                                        </div>
                                                        <div class="d-block">
                                                            <h1 class="mb-0">
                                                                <b>
                                                                    <output name="amount" id="amount" for="pointsInput">100</output>
                                                                </b> Cebul
                                                            </h1>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-12">
                                            <div class="card card-body border-0 shadow mb-4">
                                                <h2 class="h5 mb-4">Wybierz zdjęcie zadania</h2>
                                                <div class="form-group">
                                                    <div class="alert alert-info d-flex align-items-center" role="alert">
                                                        <svg class="bi flex-shrink-0 me-2" width="24" height="24" role="img" aria-label="Info:">
                                                            <use xlink:href="#info-fill" />
                                                        </svg>
                                                        <div>
                                                            Dopuszczalalne formaty: <b>.jpg</b> lub <b>.png</b> o maksymalnej wielkości <b>2Mb</b>
                                                        </div>
                                                    </div>
                                                    <input id="photo" class="form-control" name="file" type="file" accept="image/png, image/jpeg" />
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-12">
                                            <div class="card card-body border-0 shadow mb-4">
                                                <h2 class="h5 mb-4">Inne</h2>
                                                <ul class="list-group list-group-flush">
                                                </ul>
                                                <p>Limituj liczbę uczestników</p>
                                                <div class="form-group">
                                                    <div class="input-group mb-3">
                                                        <input asp-for="LeftDoneAttempts" placeholder="Bez limitu" min="1" class="form-control" />
                                                        <button type="button" class="btn btn-outline-secondary" data-bs-container="body" data-bs-toggle="popover" data-bs-placement="top" data-bs-content="Możesz określić maksymalną liczbę uczestników, którzy mogą wykonać zadanie. Po przekroczeniu tej liczby stanie się ono nieaktywne">
                                                            Pomocy?
                                                        </button>
                                                    </div>
                                                    <span asp-validation-for="LeftDoneAttempts" class="text-danger cb-alert"></span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!--description panel-->
                        <div class="tab-pane fade" id="create-description" role="tabpanel" aria-labelledby="tab-link-example-15">
                            <div class="row">
                                <div class="col-12 col-xl-8">
                                    <div class="card card-body border-0 shadow mb-4">
                                        <h2 class="h5 mb-4">Szczegółowy opis zadania</h2>
                                        <div class="form-group">
                                            <span asp-validation-for="Description" class="text-danger cb-alert"></span>
                                            <textarea id="description" asp-for="Description" class="form-control">Welcome to TinyMCE!</textarea>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-12 col-xl-4">
                                    <div class="alert alert-success" role="alert">
                                        <h4 class="alert-heading">Jak opisać zadanie?</h4>
                                        <p>Tak aby było ciekawie! W opisie umieść wskazówki potrzebne do wykonania zadania, a także podpowiedzi, ciekawostki i zagwozdki. Wszystko zależy od Ciebie!</p>
                                        <hr>
                                        <p class="mb-0">Możesz załączać grafiki, filmy (np. YouTube) i inne treści</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!--after done message panel-->
                        <div class="tab-pane fade" id="create-afterdonemessage" role="tabpanel" aria-labelledby="tab-link-example-15">
                            <div class="row">
                                <div class="col-12 col-xl-8">
                                    <div class="card card-body border-0 shadow mb-4">
                                        <h2 class="h5 mb-4">Wiadomość końcowa</h2>
                                        <div class="form-group">
                                            <span asp-validation-for="AfterDoneMessage" class="text-danger cb-alert"></span>
                                            <textarea id="afterdonemessage" asp-for="AfterDoneMessage" class="form-control">Welcome to TinyMCE!</textarea>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-12 col-xl-4">
                                    <div class="alert alert-success" role="alert">
                                        <h4 class="alert-heading">Wiadomość po zakończeniu</h4>
                                        <p>Tutaj możesz umieścić wiadomość która wyświetli się po ukończeniu zadania - w zależności od jego typu.</p>
                                        <hr>
                                        <p class="mb-0">Możesz załączać grafiki, filmy (np. YouTube) i inne treści</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</form>

@section Scripts {
    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    <script>
        tinymce.init({
            selector: '#description, #afterdonemessage',
            plugins: [
                'advlist autolink lists link image charmap print preview anchor',
                'searchreplace visualblocks code fullscreen',
                'insertdatetime media table paste code help wordcount'
            ],
            toolbar: 'undo redo | styleselect | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | outdent indent | image',
            language: 'pl',
            height: 600
        });
        tinymce.init({
            selector: '#short-description',
            plugins: [
                'advlist autolink lists preview anchor',
                'searchreplace visualblocks code fullscreen',
                'wordcount'
            ],
            toolbar: 'undo redo | bold italic ',
            language: 'pl',
            height: 300
        });
    </script>
}
